<div class="container-fluid">
  <div class="row">
    <div class="col-12 mt-3">
      <mat-tab-group mat-align-tabs="center" selectedIndex="1">
        <mat-tab>
          <ng-template mat-tab-label>
            <div>
              <span
                class="material-icons md-24 d-block"
                style="color: #00a699; font-size: 25px !important"
              >
                call_received
              </span>
              Reservas recibidas
            </div>
          </ng-template>
          <div class="container">
            <div class="row mt-5">
              <div class="col-12">
                <p class="p-filtro p-0 mt-2 text-center">
                  Reservaciones recibidas
                  <span
                    matTooltip="Si publicó una propiedad, en esta sección se indicarán las reservaciones solicitadas por parte de los huéspedes"
                    matTooltipPosition="right"
                    class="ml-2 material-icons"
                    >help_outline</span
                  >
                </p>

                <hr class="mb-5 separacion-filtro-color" />
              </div>
            </div>
            <div class="row">
              <form autocomplete="off" [formGroup]="propiedad_seleccionada">
                <div class="row">
                  <div class="col">
                    <mat-form-field>
                      <mat-label>Propiedad</mat-label>
                      <mat-select formControlName="propiedad_id">
                        <mat-option
                          *ngFor="let item of array_id_propiedades"
                          [value]="item.propiedad_id"
                          >{{ item.nombre }}</mat-option
                        >
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col">
                    <mat-form-field>
                      <mat-label>Estado</mat-label>
                      <mat-select formControlName="confirmada">
                        <mat-option value="0">Sin Confirmar</mat-option>
                        <mat-option value="1">Confirmadas</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
              </form>
            </div>
            <div class="row">
              <div class="table-responsive">
                <table class="table">
                  <thead class="text-center">
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Fechas</th>
                      <th scope="col">Valor por reservación</th>
                      <th scope="col">Huésped</th>
                      <th scope="col">Acción</th>
                    </tr>
                  </thead>

                  <tbody class="text-center" *ngIf="reservas">
                    <tr *ngIf="reserva_bandera">
                      <td class="text-center">No existen reservas</td>
                    </tr>
                    <tr *ngFor="let item of reservas; let i = index">
                      <th scope="row">{{ i + 1 }}</th>
                      <td>
                        {{ item.fechas_reservadas.start | date }} -
                        {{ item.fechas_reservadas.end | date }}
                      </td>
                      <td>{{ item.precio | currency }}</td>
                      <td>
                        <span class="img-p-sp mr-2"
                          ><img
                            class="img-prop shadow"
                            [src]="item.huesped_info.picture"
                            [title]="item.huesped_info.nombre_huesped"
                        /></span>
                        {{ item.huesped_info.nombre_huesped.split(" ")[0] }}
                      </td>
                      <td *ngIf="item.reserva_confirmada == 0">
                        <button
                          mat-raised-button
                          type="button"
                          (click)="confirmarReserva(item.id_reserva, i)"
                        >
                          <span
                            class="material-icons md-24 d-block"
                            style="color: #00a699; font-size: 25px !important"
                          >
                            check
                          </span>
                        </button>
                        <button
                          mat-raised-button
                          type="button"
                          (click)="rechazarReserva(item.id_reserva, i)"
                        >
                          <span
                            class="material-icons md-24 d-block"
                            style="color: #00a699; font-size: 25px !important"
                          >
                            clear
                          </span>
                        </button>
                      </td>
                      <td>
                        <button
                          *ngIf="evaluarEstadoPago(item.info_mp)"
                          mat-stroked-button
                          style="width: 100% !important"
                          (click)="openDialog(item, 'propietario')"
                          type="button"
                        >
                          Huesped
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <hr class="mb-5 separacion-filtro-color" />
            </div>
          </div>
        </mat-tab>
        <!-- Reservas recibidas -->

        <!-- Reservas enviadas -->
        <mat-tab>
          <ng-template mat-tab-label>
            <div>
              <span
                class="material-icons md-24 d-block"
                style="color: #00a699; font-size: 25px !important"
              >
                call_made
              </span>
              Reservas enviadas
            </div>
          </ng-template>
          <div class="container">
            <div class="row mt-5">
              <div class="col-12">
                <p class="p-filtro p-0 mt-2 text-center">
                  Reservaciones enviadas
                  <span
                    matTooltip="Si reservó una propiedad, en esta sección se indicará si fue o no aceptada"
                    matTooltipPosition="right"
                    class="ml-2 material-icons"
                    >help_outline</span
                  >
                </p>

                <hr class="mb-5 separacion-filtro-color" />
              </div>
            </div>
            <div class="row">
              <form autocomplete="off" [formGroup]="reserva_seleccionada">
                <div class="row">
                  <div class="col">
                    <mat-form-field>
                      <mat-label>Estado</mat-label>
                      <mat-select formControlName="confirmada">
                        <mat-option value="0">Sin Confirmar</mat-option>
                        <mat-option value="1">Confirmadas</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
              </form>
            </div>
            <div class="row">
              <div class="table-responsive">
                <table class="table">
                  <thead class="text-center">
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Propiedad</th>
                      <th scope="col">Fechas</th>
                      <th scope="col">Valor por reservación</th>
                      <th scope="col">Confirmada</th>
                      <th scope="col">Pagar</th>
                    </tr>
                  </thead>

                  <tbody class="text-center" *ngIf="reservas_enviadas">
                    <tr *ngIf="reserva_bandera_env">
                      <td class="text-center">No existen reservas</td>
                    </tr>
                    <tr *ngFor="let item of reservas_enviadas; let i = index">
                      <th scope="row">{{ i + 1 }}</th>
                      <td>
                        <a [routerLink]="['/propiedad', item.propiedad_id]">{{
                          item.caracteristicas_propiedad.nombre_propiedad
                            | titlecase
                        }}</a>
                      </td>
                      <td>
                        {{ item.fechas_reservadas.start | date }} -
                        {{ item.fechas_reservadas.end | date }}
                      </td>
                      <td>{{ item.precio | currency }}</td>

                      <td *ngIf="item.reserva_confirmada == 0">No</td>
                      <td *ngIf="item.reserva_confirmada == 1">Si</td>
                      <td>
                        <button
                          *ngIf="item.reserva_confirmada == 0"
                          mat-flat-button
                          mat-dialog-close
                          style="background: #009ee3 !important"
                          disabled
                        >
                          Reservar
                        </button>

                        <app-mercadopago-button
                          *ngIf="item.reserva_confirmada == 1 && !item.info_mp"
                          [propiedad]="item"
                        ></app-mercadopago-button>
                        <button
                          *ngIf="evaluarEstadoPago(item.info_mp)"
                          mat-stroked-button
                          style="width: 100% !important"
                          (click)="openDialog(item, 'huesped')"
                          type="button"
                        >
                          Propietario
                        </button>
                      </td>
                      <!-- <td *ngIf="item.info_mp">info-mp</td> -->
                    </tr>
                  </tbody>
                </table>
              </div>
              <hr class="mb-5 separacion-filtro-color" />
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
